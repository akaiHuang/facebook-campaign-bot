<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æŠ½çæ©Ÿå™¨äººå¾Œå°ç®¡ç†</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1000px;
            margin: 0 auto;
        }
        
        .header {
            background: white;
            border-radius: 10px;
            padding: 30px;
            margin-bottom: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        
        h1 {
            color: #667eea;
            margin-bottom: 10px;
        }
        
        .subtitle {
            color: #666;
            font-size: 14px;
        }
        
        .card {
            background: white;
            border-radius: 10px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        
        .card h2 {
            color: #333;
            margin-bottom: 20px;
            font-size: 20px;
            border-bottom: 2px solid #667eea;
            padding-bottom: 10px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            color: #333;
            font-weight: 500;
        }
        
        input[type="text"],
        textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 6px;
            font-size: 14px;
            transition: border-color 0.3s;
        }
        
        input[type="text"]:focus,
        textarea:focus {
            outline: none;
            border-color: #667eea;
        }
        
        textarea {
            resize: vertical;
            min-height: 100px;
        }
        
        .hint {
            font-size: 12px;
            color: #999;
            margin-top: 5px;
        }
        
        .button-group {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }
        
        button {
            flex: 1;
            padding: 12px 24px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .btn-primary {
            background: #667eea;
            color: white;
        }
        
        .btn-primary:hover {
            background: #5568d3;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(102, 126, 234, 0.3);
        }
        
        .btn-secondary {
            background: #f0f0f0;
            color: #333;
        }
        
        .btn-secondary:hover {
            background: #e0e0e0;
        }
        
        .btn-danger {
            background: #ff6b6b;
            color: white;
        }
        
        .btn-danger:hover {
            background: #ff5252;
        }
        
        .status {
            padding: 15px;
            border-radius: 6px;
            margin-bottom: 20px;
        }
        
        .status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .status.info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        
        .current-config {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 6px;
            border-left: 4px solid #667eea;
        }
        
        .current-config p {
            margin: 8px 0;
            color: #555;
        }
        
        .current-config strong {
            color: #333;
        }
        
        .tag {
            display: inline-block;
            background: #667eea;
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            margin: 3px;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .stat-box {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
        }
        
        .stat-number {
            font-size: 32px;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .stat-label {
            font-size: 14px;
            opacity: 0.9;
        }
        
        .loading {
            display: none;
            text-align: center;
            padding: 20px;
        }
        
        .loading.show {
            display: block;
        }
        
        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* è²¼æ–‡æ¸…å–®æ¨£å¼ */
        .post-item {
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: all 0.3s;
            background: white;
        }
        
        .post-item:hover {
            border-color: #667eea;
            background: #f8f9ff;
            transform: translateX(5px);
        }
        
        .post-item.selected {
            border-color: #667eea;
            background: #e0e7ff;
            border-width: 3px;
        }
        
        .post-id {
            font-family: 'Courier New', monospace;
            font-size: 12px;
            color: #667eea;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .post-preview {
            color: #555;
            font-size: 14px;
            margin: 8px 0;
            line-height: 1.4;
        }
        
        .post-meta {
            font-size: 12px;
            color: #999;
            margin-top: 8px;
            display: flex;
            gap: 15px;
        }
        
        .post-meta span {
            display: flex;
            align-items: center;
            gap: 4px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ¤– æŠ½çæ©Ÿå™¨äººå¾Œå°ç®¡ç†</h1>
            <p class="subtitle">Kreme Select ç²‰å°ˆè‡ªå‹•å›è¦†ç³»çµ±</p>
        </div>

        <div id="statusMessage"></div>

        <!-- ç•¶å‰è¨­å®š -->
        <div class="card">
            <h2>ğŸ“Š ç•¶å‰è¨­å®š</h2>
            <div class="current-config" id="currentConfig">
                <p><strong>ç›£æ§æ–‡ç« ï¼š</strong><span id="currentPostIds">è¼‰å…¥ä¸­...</span></p>
                <p><strong>é—œéµå­—ï¼š</strong><span id="currentKeywords">è¼‰å…¥ä¸­...</span></p>
                <p><strong>åœ–ç‰‡æ•¸é‡ï¼š</strong><span id="currentImageCount">è¼‰å…¥ä¸­...</span></p>
            </div>
        </div>

        <!-- æ–‡ç« è¨­å®š -->
        <div class="card">
            <h2>ğŸ“ æ–‡ç« è¨­å®š</h2>
            
            <!-- æœ€è¿‘çš„è²¼æ–‡æ¸…å–® -->
            <div class="form-group">
                <label>ğŸ” ç²‰çµ²å°ˆé æœ€è¿‘çš„è²¼æ–‡ï¼ˆé»æ“Šé¸æ“‡ï¼‰</label>
                <div id="recentPosts" style="max-height: 300px; overflow-y: auto; border: 2px solid #e0e0e0; border-radius: 6px; padding: 10px; margin-bottom: 15px;">
                    <div style="text-align: center; color: #999; padding: 20px;">
                        è¼‰å…¥ä¸­...
                    </div>
                </div>
                <button class="btn-secondary" onclick="loadRecentPosts()" style="margin-bottom: 20px;">ğŸ”„ é‡æ–°è¼‰å…¥è²¼æ–‡æ¸…å–®</button>
            </div>
            
            <!-- æ‰‹å‹•è¼¸å…¥ -->
            <div class="form-group">
                <label for="postIds">æˆ–æ‰‹å‹•è¼¸å…¥æ–‡ç«  IDï¼ˆå¯å¤šå€‹ï¼Œç”¨é€—è™Ÿåˆ†éš”ï¼‰</label>
                <textarea id="postIds" placeholder="ä¾‹å¦‚ï¼š261205178149570_123456789,261205178149570_987654321&#10;ç•™ç©ºè¡¨ç¤ºç›£æ§æ‰€æœ‰æ–‡ç« "></textarea>
                <div class="hint">
                    ğŸ’¡ æç¤ºï¼šæ–‡ç«  ID æ ¼å¼ç‚ºã€Œç²‰å°ˆID_è²¼æ–‡IDã€<br>
                    âš ï¸ <strong>ç•™ç©º = ç›£æ§æ‰€æœ‰è²¼æ–‡</strong><br>
                    âš ï¸ <strong>å¡«å¯« = åªç›£æ§æŒ‡å®šè²¼æ–‡</strong>
                </div>
            </div>
            <button class="btn-primary" onclick="updatePostIds()">âœ… æ›´æ–°æ–‡ç« è¨­å®š</button>
        </div>

        <!-- é—œéµå­—è¨­å®š -->
        <div class="card">
            <h2>ğŸ”‘ ç•™è¨€é—œéµå­—è¨­å®š</h2>
            <div class="form-group">
                <label for="commentKeywords">ç•™è¨€è§¸ç™¼é—œéµå­—ï¼ˆç”¨é€—è™Ÿåˆ†éš”ï¼‰</label>
                <input type="text" id="commentKeywords" placeholder="ä¾‹å¦‚ï¼šé¦™è•‰,æ——è¢">
                <div class="hint">
                    ğŸ’¡ ç”¨æˆ¶ç•™è¨€åŒ…å«ä»»ä¸€é—œéµå­—å³æœƒè§¸ç™¼è‡ªå‹•å›è¦†<br>
                    âš ï¸ <strong>ç•™ç©º = ä½¿ç”¨é è¨­é—œéµå­—ï¼ˆæŠ½ç,åƒåŠ ,+1,æˆ‘è¦ï¼‰</strong><br>
                    âš ï¸ <strong>å¡«å¯« = å®Œå…¨å–ä»£é è¨­é—œéµå­—ï¼ˆä¸åŒ…å«é è¨­å­—ï¼‰</strong>
                </div>
            </div>
            
            <div class="form-group">
                <label for="messageKeywords">ç§è¨Šè§¸ç™¼é—œéµå­—ï¼ˆç”¨é€—è™Ÿåˆ†éš”ï¼‰</label>
                <input type="text" id="messageKeywords" placeholder="ä¾‹å¦‚ï¼šé ˜å–,æˆ‘è¦">
                <div class="hint">
                    ğŸ’¡ ç”¨æˆ¶ç§è¨ŠåŒ…å«ä»»ä¸€é—œéµå­—å³æœƒç™¼é€åœ–ç‰‡<br>
                    âš ï¸ <strong>ç•™ç©º = ä½¿ç”¨é è¨­é—œéµå­—ï¼ˆé ˜å–ï¼‰</strong><br>
                    âš ï¸ <strong>å¡«å¯« = å®Œå…¨å–ä»£é è¨­é—œéµå­—</strong>
                </div>
            </div>
            
            <button class="btn-primary" onclick="updateKeywords()">âœ… æ›´æ–°é—œéµå­—</button>
        </div>

        <!-- åœ–ç‰‡è¨­å®š -->
        <div class="card">
            <h2>ğŸ–¼ï¸ åœ–ç‰‡è¨­å®š</h2>
            <div class="form-group">
                <label for="imageUrl1">åœ–ç‰‡ 1 URL</label>
                <input type="text" id="imageUrl1" placeholder="https://...">
            </div>
            <div class="form-group">
                <label for="imageUrl2">åœ–ç‰‡ 2 URL</label>
                <input type="text" id="imageUrl2" placeholder="https://...">
            </div>
            <div class="hint">ğŸ’¡ è«‹ä½¿ç”¨ Firebase Storage æˆ–å…¶ä»–ç©©å®šçš„åœ–åºŠ</div>
            <button class="btn-primary" onclick="updateImages()">âœ… æ›´æ–°åœ–ç‰‡</button>
        </div>

        <!-- çµ±è¨ˆæ•¸æ“š -->
        <div class="card">
            <h2>ğŸ“ˆ ä½¿ç”¨çµ±è¨ˆ</h2>
            <div class="stats-grid">
                <div class="stat-box">
                    <div class="stat-number" id="totalUsers">-</div>
                    <div class="stat-label">ç¸½ç”¨æˆ¶æ•¸</div>
                </div>
                <div class="stat-box">
                    <div class="stat-number" id="totalComments">-</div>
                    <div class="stat-label">ç¸½ç•™è¨€æ•¸</div>
                </div>
                <div class="stat-box">
                    <div class="stat-number" id="todayResponses">-</div>
                    <div class="stat-label">ä»Šæ—¥å›æ‡‰</div>
                </div>
            </div>
            <button class="btn-secondary" onclick="loadStats()" style="margin-top: 15px;">ğŸ”„ é‡æ–°è¼‰å…¥çµ±è¨ˆ</button>
        </div>

        <div class="loading" id="loading">
            <div class="spinner"></div>
            <p style="margin-top: 10px; color: white;">è™•ç†ä¸­...</p>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getFirestore, doc, getDoc, setDoc, collection, getDocs, query, where, Timestamp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';

        const firebaseConfig = {
            apiKey: "AIzaSyDWP-ZGDPCshkOxWFjOp7sNHj4vp9_j5rg",
            authDomain: "fanbot-b8f92.firebaseapp.com",
            projectId: "fanbot-b8f92",
            storageBucket: "fanbot-b8f92.firebasestorage.app",
            messagingSenderId: "724706634599",
            appId: "1:724706634599:web:d9f5f9c8f9c8f9c8f9c8f9"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // è¼‰å…¥ç•¶å‰è¨­å®š
        async function loadConfig() {
            try {
                const configDoc = await getDoc(doc(db, 'config', 'bot'));
                if (configDoc.exists()) {
                    const data = configDoc.data();
                    
                    // é¡¯ç¤ºç•¶å‰è¨­å®š
                    const postIds = data.targetPostIds || [];
                    document.getElementById('currentPostIds').innerHTML = 
                        postIds.length > 0 
                            ? postIds.map(id => `<span class="tag">${id}</span>`).join('')
                            : '<span class="tag">å…¨éƒ¨æ–‡ç« </span>';
                    
                    // é¡¯ç¤ºç•™è¨€é—œéµå­—
                    const commentKeywords = data.commentKeywords || [];
                    const commentDisplay = commentKeywords.length > 0
                        ? commentKeywords.map(kw => `<span class="tag">${kw}</span>`).join('')
                        : '<span class="tag">é è¨­ï¼šæŠ½ç,åƒåŠ ,+1,æˆ‘è¦</span>';
                    
                    // é¡¯ç¤ºç§è¨Šé—œéµå­—
                    const messageKeywords = data.messageKeywords || [];
                    const messageDisplay = messageKeywords.length > 0
                        ? messageKeywords.map(kw => `<span class="tag">${kw}</span>`).join('')
                        : '<span class="tag">é è¨­ï¼šé ˜å–</span>';
                    
                    document.getElementById('currentKeywords').innerHTML = 
                        `<strong>ç•™è¨€ï¼š</strong>${commentDisplay}<br><strong>ç§è¨Šï¼š</strong>${messageDisplay}`;
                    
                    const imageUrls = data.imageUrls || [];
                    document.getElementById('currentImageCount').textContent = imageUrls.length;
                    
                    // å¡«å…¥è¡¨å–®
                    document.getElementById('postIds').value = postIds.join(',');
                    document.getElementById('commentKeywords').value = commentKeywords.join(',');
                    document.getElementById('messageKeywords').value = messageKeywords.join(',');
                    if (imageUrls[0]) document.getElementById('imageUrl1').value = imageUrls[0];
                    if (imageUrls[1]) document.getElementById('imageUrl2').value = imageUrls[1];
                } else {
                    showMessage('å°šç„¡è¨­å®šè³‡æ–™ï¼Œè«‹å…ˆè¨­å®šæ©Ÿå™¨äººåƒæ•¸', 'info');
                }
            } catch (error) {
                console.error('è¼‰å…¥è¨­å®šå¤±æ•—:', error);
                showMessage('è¼‰å…¥è¨­å®šå¤±æ•—ï¼š' + error.message, 'error');
            }
        }

        // è¼‰å…¥çµ±è¨ˆæ•¸æ“š
        async function loadStats() {
            try {
                const usersSnapshot = await getDocs(collection(db, 'users'));
                document.getElementById('totalUsers').textContent = usersSnapshot.size;

                const commentsSnapshot = await getDocs(collection(db, 'comments'));
                document.getElementById('totalComments').textContent = commentsSnapshot.size;

                // ä»Šæ—¥å›æ‡‰æ•¸ï¼ˆç°¡åŒ–ç‰ˆï¼Œå¯¦éš›å¯ä»¥åŠ å…¥æ™‚é–“ç¯©é¸ï¼‰
                const today = new Date();
                today.setHours(0, 0, 0, 0);
                const todayComments = commentsSnapshot.docs.filter(doc => {
                    const data = doc.data();
                    return data.timestamp && data.timestamp.toDate() >= today;
                });
                document.getElementById('todayResponses').textContent = todayComments.length;
            } catch (error) {
                console.error('è¼‰å…¥çµ±è¨ˆå¤±æ•—:', error);
            }
        }

        // æ›´æ–°æ–‡ç«  ID
        window.updatePostIds = async function() {
            const postIdsText = document.getElementById('postIds').value.trim();
            const postIds = postIdsText ? postIdsText.split(',').map(id => id.trim()).filter(id => id) : [];
            
            showLoading(true);
            try {
                await setDoc(doc(db, 'config', 'bot'), {
                    targetPostIds: postIds,
                    updatedAt: Timestamp.now()
                }, { merge: true });
                
                showMessage(`âœ… æ–‡ç« è¨­å®šå·²æ›´æ–°ï¼${postIds.length > 0 ? `ç›£æ§ ${postIds.length} ç¯‡æ–‡ç« ` : 'ç›£æ§æ‰€æœ‰æ–‡ç« '}`, 'success');
                loadConfig();
            } catch (error) {
                showMessage('âŒ æ›´æ–°å¤±æ•—ï¼š' + error.message, 'error');
            }
            showLoading(false);
        };

        // æ›´æ–°é—œéµå­—
        window.updateKeywords = async function() {
            const commentKeywordsText = document.getElementById('commentKeywords').value.trim();
            const messageKeywordsText = document.getElementById('messageKeywords').value.trim();
            
            // ç•™è¨€é—œéµå­—ï¼šç©ºç™½ = ä½¿ç”¨é è¨­ï¼Œå¦å‰‡å®Œå…¨å–ä»£
            const commentKeywords = commentKeywordsText 
                ? commentKeywordsText.split(',').map(kw => kw.trim()).filter(kw => kw)
                : [];  // ç©ºé™£åˆ—è¡¨ç¤ºä½¿ç”¨é è¨­
            
            // ç§è¨Šé—œéµå­—ï¼šç©ºç™½ = ä½¿ç”¨é è¨­ï¼Œå¦å‰‡å®Œå…¨å–ä»£
            const messageKeywords = messageKeywordsText
                ? messageKeywordsText.split(',').map(kw => kw.trim()).filter(kw => kw)
                : [];  // ç©ºé™£åˆ—è¡¨ç¤ºä½¿ç”¨é è¨­
            
            showLoading(true);
            try {
                await setDoc(doc(db, 'config', 'bot'), {
                    commentKeywords: commentKeywords,
                    messageKeywords: messageKeywords,
                    updatedAt: Timestamp.now()
                }, { merge: true });
                
                const commentMsg = commentKeywords.length > 0 
                    ? `è‡ªè¨‚ ${commentKeywords.length} å€‹ç•™è¨€é—œéµå­—`
                    : 'ä½¿ç”¨é è¨­ç•™è¨€é—œéµå­—';
                const messageMsg = messageKeywords.length > 0
                    ? `è‡ªè¨‚ ${messageKeywords.length} å€‹ç§è¨Šé—œéµå­—`
                    : 'ä½¿ç”¨é è¨­ç§è¨Šé—œéµå­—';
                
                showMessage(`âœ… é—œéµå­—å·²æ›´æ–°ï¼<br>${commentMsg}<br>${messageMsg}`, 'success');
                loadConfig();
            } catch (error) {
                showMessage('âŒ æ›´æ–°å¤±æ•—ï¼š' + error.message, 'error');
            }
            showLoading(false);
        };

        // æ›´æ–°åœ–ç‰‡
        window.updateImages = async function() {
            const url1 = document.getElementById('imageUrl1').value.trim();
            const url2 = document.getElementById('imageUrl2').value.trim();
            
            if (!url1 && !url2) {
                showMessage('âŒ è«‹è‡³å°‘è¼¸å…¥ä¸€å€‹åœ–ç‰‡ URL', 'error');
                return;
            }
            
            const imageUrls = [url1, url2].filter(url => url);
            
            showLoading(true);
            try {
                await setDoc(doc(db, 'config', 'bot'), {
                    imageUrls: imageUrls,
                    updatedAt: Timestamp.now()
                }, { merge: true });
                
                showMessage(`âœ… åœ–ç‰‡å·²æ›´æ–°ï¼å…± ${imageUrls.length} å¼µåœ–ç‰‡`, 'success');
                loadConfig();
            } catch (error) {
                showMessage('âŒ æ›´æ–°å¤±æ•—ï¼š' + error.message, 'error');
            }
            showLoading(false);
        };

        // é¡¯ç¤ºè¨Šæ¯
        function showMessage(message, type) {
            const statusDiv = document.getElementById('statusMessage');
            statusDiv.innerHTML = `<div class="status ${type}">${message}</div>`;
            setTimeout(() => {
                statusDiv.innerHTML = '';
            }, 5000);
        }

        // é¡¯ç¤ºè¼‰å…¥ä¸­
        function showLoading(show) {
            const loadingDiv = document.getElementById('loading');
            if (show) {
                loadingDiv.classList.add('show');
            } else {
                loadingDiv.classList.remove('show');
            }
        }

        window.loadStats = loadStats;

        // è¼‰å…¥æœ€è¿‘çš„è²¼æ–‡æ¸…å–®ï¼ˆå¾ Facebook APIï¼‰
        async function loadRecentPosts() {
            const container = document.getElementById('recentPosts');
            container.innerHTML = '<div style="text-align: center; color: #999; padding: 20px;">è¼‰å…¥ä¸­...</div>';
            
            try {
                // ä½¿ç”¨å›ºå®šçš„é…ç½®ï¼ˆèˆ‡ index.js ä¸­çš„è¨­å®šä¸€è‡´ï¼‰
                const PAGE_ACCESS_TOKEN = 'YOUR_PAGE_ACCESS_TOKEN'; // Set via environment
                const FACEBOOK_PAGE_ID = '261205178149570';
                
                // èª¿ç”¨ Facebook Graph API ç²å–ç²‰çµ²å°ˆé è²¼æ–‡
                const response = await fetch(
                    `https://graph.facebook.com/v18.0/${FACEBOOK_PAGE_ID}/posts?fields=id,message,created_time,permalink_url&limit=20&access_token=${PAGE_ACCESS_TOKEN}`
                );
                
                if (!response.ok) {
                    throw new Error(`Facebook API éŒ¯èª¤: ${response.status}`);
                }
                
                const data = await response.json();
                
                if (!data.data || data.data.length === 0) {
                    container.innerHTML = `
                        <div style="text-align: center; color: #999; padding: 20px;">
                            <p>ğŸ“­ ç›®å‰æ²’æœ‰è²¼æ–‡</p>
                        </div>
                    `;
                    return;
                }
                
                // ç²å–ç›®å‰é¸ä¸­çš„è²¼æ–‡ ID
                const currentPostIds = document.getElementById('postIds').value.trim().split(',').map(id => id.trim()).filter(id => id);
                
                // æ¸²æŸ“è²¼æ–‡åˆ—è¡¨
                container.innerHTML = data.data.map(post => {
                    const isSelected = currentPostIds.includes(post.id);
                    const message = post.message || '(ç„¡æ–‡å­—å…§å®¹)';
                    const preview = message.length > 80 ? message.substring(0, 80) + '...' : message;
                    const timeAgo = getTimeAgo(new Date(post.created_time));
                    
                    return `
                        <div class="post-item ${isSelected ? 'selected' : ''}" onclick="togglePostSelection('${post.id}')">
                            <div class="post-id">ğŸ“Œ ${post.id}</div>
                            <div class="post-preview">${preview}</div>
                            <div class="post-meta">
                                <span>ï¿½ ${timeAgo}</span>
                                <a href="${post.permalink_url}" target="_blank" onclick="event.stopPropagation()">ğŸ”— æŸ¥çœ‹è²¼æ–‡</a>
                            </div>
                        </div>
                    `;
                }).join('');
                
            } catch (error) {
                console.error('è¼‰å…¥è²¼æ–‡å¤±æ•—:', error);
                container.innerHTML = `
                    <div style="text-align: center; color: #e53e3e; padding: 20px;">
                        âŒ è¼‰å…¥å¤±æ•—ï¼š${error.message}
                    </div>
                `;
            }
        }
        
        // åˆ‡æ›è²¼æ–‡é¸æ“‡
        window.togglePostSelection = function(postId) {
            const postIdsInput = document.getElementById('postIds');
            const currentIds = postIdsInput.value.trim().split(',').map(id => id.trim()).filter(id => id);
            
            if (currentIds.includes(postId)) {
                // å–æ¶ˆé¸æ“‡
                const newIds = currentIds.filter(id => id !== postId);
                postIdsInput.value = newIds.join(',');
            } else {
                // æ–°å¢é¸æ“‡
                currentIds.push(postId);
                postIdsInput.value = currentIds.join(',');
            }
            
            // é‡æ–°è¼‰å…¥æ¸…å–®ä»¥æ›´æ–°é¸ä¸­ç‹€æ…‹
            loadRecentPosts();
        };
        
        // è¨ˆç®—æ™‚é–“å·®
        function getTimeAgo(date) {
            const now = new Date();
            const diff = Math.floor((now - date) / 1000); // ç§’
            
            if (diff < 60) return 'å‰›å‰›';
            if (diff < 3600) return `${Math.floor(diff / 60)} åˆ†é˜å‰`;
            if (diff < 86400) return `${Math.floor(diff / 3600)} å°æ™‚å‰`;
            if (diff < 604800) return `${Math.floor(diff / 86400)} å¤©å‰`;
            return date.toLocaleDateString('zh-TW');
        }

        // åˆå§‹åŒ–
        loadConfig();
        loadStats();
        loadRecentPosts();
    </script>
</body>
</html>
